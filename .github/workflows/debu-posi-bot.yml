name: PosiDev Bot - Combined Daily Post & Monitor

# このワークフローは debu-posi-marketing.yml (毎日投稿) と
# debu-posi-monitor.yml (メンション監視) に統合されました。
# 個別に実行する場合はこちらを使用。

on:
  workflow_dispatch:
    inputs:
      mode:
        description: 'モード (tweet / monitor / both)'
        required: false
        default: 'both'

permissions:
  issues: write

jobs:
  posideb:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install deps
        run: pip install tweepy

      - name: Post daily tweet
        if: ${{ github.event.inputs.mode == 'tweet' || github.event.inputs.mode == 'both' }}
        env:
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}
        run: python scripts/debu-posi-tweet-generator.py

      - name: Monitor & auto-reply
        if: ${{ github.event.inputs.mode == 'monitor' || github.event.inputs.mode == 'both' }}
        env:
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_SECRET: ${{ secrets.X_ACCESS_SECRET }}
          X_BEARER_TOKEN: ${{ secrets.X_BEARER_TOKEN }}
        run: python scripts/debu-posi-monitor.py
